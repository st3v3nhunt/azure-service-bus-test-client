{% extends 'layout.njk' %}

{% block content %}

<div class="container">
  <div class="column">
    <h1 class="title is-2">Azure Service Bus Test Client</h1>

    <form id="frm-message" action="/">

      <div class="field">
        <label class="label">Connection String</label>
        <div class="control">
          <input class="input" type="text" name="connectionString">
        </div>
      </div>

      <div class="field">
        <label class="label">Queue</label>
        <div class="control">
          <input class="input" type="text" name="queue">
        </div>
      </div>

      <div class="field">
        <label class="label">Message Id Property Name</label>
        <div class="control">
          <input class="input" type="text" name="messageId">
        </div>
      </div>

      <div class="field">
        <label class="label">Message</label>
        <div class="control">
          <textarea class="textarea" name="message"></textarea>
        </div>
      </div>

      <div class="field">
        <div class="control">
          <label class="radio">
            <input type="radio" name="format" value="json" checked>
            JSON
          </label>
          <label class="radio">
            <input type="radio" name="format" value="string">
            String
          </label>
        </div>
      </div>

      <div class="field">
        <div class="control">
          <button class="button is-link" id="send">Send</button>
        </div>
      </div>
    </form>
  </div>

  <div id="result" class="column" style="display: none">
    <article class="message is-primary">
      <div id="result-text" class="message-body">
      </div>
    </article>
  </div>

</div>

<script>
  $("#frm-message").submit(function (e) {
    e.preventDefault()
    $('#send').addClass('is-loading')
    $('#result').fadeOut(0)

    var form = $(this);
    var url = form.attr('action')

    setTimeout(() => {
      $('#send').removeClass('is-loading')
    }, 2000)

    $.ajax({
      type: "POST",
      url: url,
      data: form.serialize(),
      success: function (data) {
        $('#result-text').html(data)
        $('#result').fadeIn(2000)
        $('#send').removeClass('is-loading')
      }
    })
  })
</script>

{% endblock %}
